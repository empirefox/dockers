#!/bin/bash

# build_aar "$@"
source $NDK_BUILD_UTILS_DIR/build_aar.sh

BUILD_TIME=$(date -u +"%Y-%m-%dT%H:%M:%SZ")
GOMOBILE_VERSION=$(gomobile version)

echo "aar build env:"
echo "GOLANG_VERSION      ${GOLANG_VERSION}"
echo "ANDROID_SDK_VERSION ${ANDROID_SDK_VERSION}"
echo "ANDROID_NDK_VERSION ${ANDROID_NDK_VERSION}"
echo "SODIUM_VERSION      ${SODIUM_VERSION}"
echo "OPUS_VERSION        ${OPUS_VERSION}"
echo "VPX_VERSION         ${VPX_VERSION}"
echo "TOXCORE_VERSION     ${TOXCORE_VERSION}"
echo "BUILD_TIME          ${BUILD_TIME}"
echo "GOMOBILE_VERSION    ${GOMOBILE_VERSION}"

# for test
# go_archs=(arm)

build_aar "$@"

cat <<EOF >$GOPATH/src/${@: -1}/gomobile-toxcore-info.json
{
  "GOLANG_VERSION": "$GOLANG_VERSION",
  "ANDROID_SDK_VERSION": "$ANDROID_SDK_VERSION",
  "ANDROID_NDK_VERSION": "$ANDROID_NDK_VERSION",
  "SODIUM_VERSION": "$SODIUM_VERSION",
  "OPUS_VERSION": "$OPUS_VERSION",
  "VPX_VERSION": "$VPX_VERSION",
  "TOXCORE_VERSION": "$TOXCORE_VERSION",
  "BUILD_TIME": "$BUILD_TIME",
  "GOMOBILE_VERSION": "$GOMOBILE_VERSION"
}
EOF
